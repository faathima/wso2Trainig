<!-- CreateDBApprovalWorkFlowProcess BPEL Process [Generated by the Eclipse BPEL Designer]  -->
<!-- Date: Mon Mar 05 12:18:58 IST 2012 -->

<bpel:process name="CreateDBApprovalWorkFlowProcess"
         targetNamespace="http://workflow.createdb.ss.carbon.wso2.org"
         suppressJoinFailure="yes"
         xmlns:tns="http://workflow.createdb.ss.carbon.wso2.org"
         xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:b4p="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" xmlns:ns1="http://org.wso2.carbon/createdb/"
          xmlns:ns="http://callback.workflow.ss.carbon.wso2.org">
    <!-- Import the client WSDL -->
    <bpel:extensions>
        <bpel:extension namespace="http://docs.oasis-open.org/ns/bpel4people/bpel4people/200803" mustUnderstand="yes"></bpel:extension>
    </bpel:extensions>
    <bpel:import namespace="http://org.wso2.carbon/createdb/" location="CreateDBApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import namespace="http://org.wso2.carbon/createdb/" location="CreateDBApprovalTaskService.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"></bpel:import>
    <bpel:import location="CreateDBApprovalWorkFlowProcessArtifacts.wsdl" namespace="http://workflow.createdb.ss.carbon.wso2.org" 
	        importType="http://schemas.xmlsoap.org/wsdl/" />
	        
    <!-- ================================================================= -->         
    <!-- PARTNERLINKS                                                      -->
    <!-- List of services participating in this BPEL process               -->
    <!-- ================================================================= -->         
    <bpel:partnerLinks>
        <!--
        The 'client' role represents the requester of this service. It is 
        used for callback. The location and correlation information associated
        with the client role are automatically set using WS-Addressing.
        -->
        <bpel:partnerLink name="client"
                     partnerLinkType="tns:CreateDBApprovalWorkFlowProcess"
                     myRole="CreateDBApprovalWorkFlowProcessProvider"
                     partnerRole="CreateDBApprovalWorkFlowProcessRequester"
                     />
        <bpel:partnerLink name="CreateDBPL" partnerLinkType="tns:AAPLT" myRole="role2" partnerRole="role1"></bpel:partnerLink>
        <bpel:partnerLink name="CBPL" partnerLinkType="tns:CBPLT" partnerRole="role3"></bpel:partnerLink>
    </bpel:partnerLinks>
  
    <!-- ================================================================= -->         
    <!-- VARIABLES                                                         -->
    <!-- List of messages and XML documents used within this BPEL process  -->
    <!-- ================================================================= -->         
    <bpel:variables>
        <!-- Reference to the message passed as input during initiation -->
        <bpel:variable name="input"
                  messageType="tns:CreateDBApprovalWorkFlowProcessRequestMessage"/>
                  
        <!-- Reference to the message that will be sent back to the 
             requester during callback
             -->
        <bpel:variable name="output"
                  messageType="ns1:CreateDBApprovalResponse"/>
        <bpel:variable name="input_ht" messageType="ns1:CreateDBApprovalRequest"></bpel:variable>
        <bpel:variable name="output_ht" messageType="ns1:CreateDBApprovalResponse"></bpel:variable>
        <bpel:variable name="clientRequest" messageType="tns:CreateDBApprovalWorkFlowProcessRequestMessage"></bpel:variable>
        <bpel:variable name="CBPLRequest" messageType="ns:resumeEventRequest"></bpel:variable>
        <!-- bpel:variable name="CBPLRequest1" messageType="ns:resumeEventRequest"></bpel:variable-->
    </bpel:variables>

    <!-- ================================================================= -->         
    <!-- ORCHESTRATION LOGIC                                               -->
    <!-- Set of activities coordinating the flow of messages across the    -->
    <!-- services integrated within this business process                  -->
    <!-- ================================================================= -->         
    <bpel:sequence name="main">
        
        <!-- Receive input from requestor. 
             Note: This maps to operation defined in CreateDBApprovalWorkFlowProcess.wsdl 
             -->
        <bpel:receive name="receiveInput" partnerLink="client"
                 createInstance="yes" operation="initiate" portType="tns:CreateDBApprovalWorkFlowProcess" variable="clientRequest"/>
        <bpel:assign validate="no" name="assign_input">
            

            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <tschema:CreateDBApprovalData xmlns:tschema="http://workflow.CreateDB.apimgt.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tschema:CreateDBName>tschema:CreateDBName</tschema:CreateDBName>
  <tschema:CreateDBId>tschema:CreateDBId</tschema:CreateDBId>
  <tschema:CreateDBTier>tschema:CreateDBTier</tschema:CreateDBTier>
  <tschema:CreateDBCallbackUrl>tschema:CreateDBCallbackUrl</tschema:CreateDBCallbackUrl>
  <tschema:CreateDBDescription>tschema:CreateDBDescription</tschema:CreateDBDescription>
  <tschema:CreateDBName>tschema:CreateDBName</tschema:CreateDBName>
  <tschema:tenantDomain>tschema:tenantDomain</tschema:tenantDomain>
  <tschema:userName>tschema:userName</tschema:userName>
  <tschema:workflowExternalRef>tschema:workflowExternalRef</tschema:workflowExternalRef>
  <tschema:callBackURL>tschema:callBackURL</tschema:callBackURL>

                        </tschema:CreateDBApprovalData>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="input_ht" part="CreateDBApprovalRequest"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="payload" variable="clientRequest"></bpel:from>
                <bpel:to part="CreateDBApprovalRequest" variable="input_ht"></bpel:to>
            </bpel:copy>
        </bpel:assign>
        
        <!-- Asynchronous callback to the requester.
             Note: the callback location and correlation id is transparently handled 
             using WS-addressing.
             -->
        <bpel:extensionActivity>
            <b4p:peopleActivity name="approve_CreateDB" inputVariable="input_ht" outputVariable="output_ht">
                <b4p:remoteTask operation="approve" responseOperation="approvalResponse"></b4p:remoteTask>
            </b4p:peopleActivity>
        </bpel:extensionActivity>
        <bpel:assign validate="no" name="assign_output">
            
            
            <bpel:copy>
                <bpel:from>
                    <bpel:literal>
                        <ns:resumeEvent xmlns:ns="http://callback.workflow.apimgt.carbon.wso2.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><ns:workflowReference>ns:workflowReference</ns:workflowReference>
  <ns:status>ns:status</ns:status>
  <ns:description>ns:description</ns:description>

                        </ns:resumeEvent>
                    </bpel:literal>
                </bpel:from>
                <bpel:to variable="CBPLRequest" part="parameters"></bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="CreateDBApprovalResponse" variable="output_ht">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:workflowExternalRef]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="CBPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:workflowReference]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="CreateDBApprovalResponse" variable="output_ht">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:status]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="CBPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:status]]></bpel:query>
                </bpel:to>
            </bpel:copy>
            <bpel:copy>
                <bpel:from part="CreateDBApprovalResponse" variable="output_ht">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:description]]></bpel:query>
                </bpel:from>
                <bpel:to part="parameters" variable="CBPLRequest">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[ns:description]]></bpel:query>
                </bpel:to>
            </bpel:copy>
        </bpel:assign>
        
        <bpel:invoke name="Invoke" partnerLink="CBPL" operation="resumeEvent" portType="ns:WorkflowCallbackServicePortType" inputVariable="CBPLRequest"></bpel:invoke>
    </bpel:sequence>
</bpel:process>
